{% extends 'base.html' %}

{% block content %}
  <h2>Hello, {{ user.name }}</h2>
  <a href="">내 프로필</a>
  <h1>Movies</h1>

  <select id="genre-select">
    <option value="">장르를 선택하시오</option>
    <option value="모험">모험</option>
    <option value="판타지">판타지</option>
    <option value="애니메이션">애니메이션</option>
    <option value="드라마">드라마</option>
    <option value="공포">공포</option>
    <option value="액션">액션</option>
    <option value="코미디">코미디</option>
    <option value="역사">역사</option>
    <option value="서부">서부</option>
    <option value="스릴러">스릴러</option>
    <option value="범죄">범죄</option>
    <option value="다큐멘터리">다큐멘터리</option>
    <option value="SF">SF</option>
    <option value="미스터리">미스터리</option>
    <option value="음악">음악</option>
    <option value="로맨스">로맨스</option>
    <option value="가족">가족</option>
    <option value="전쟁">전쟁</option>
    <option value="TV 영화">TV 영화</option>
    
    {% for genre in genres %}
    <option value="{{ movies.pk}}">{{ movie.name }}</option>
    {% endfor %} 
  </select>
    
  <div id="movie-list">
    <!-- 영화 목록이 여기에 표시됩니다. -->
    {% for movie in movies %}
      <ul>
        <li>{{ movie.title }}</li>
      </ul>
    {% endfor %}
  </div>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js'></script>

  <script>
    const genreSelect = document.querySelector('#genre-select');

    genreSelect.addEventListener('change', function() {
      const genre = this.value;
      const url = `/movies/filter-genre/?genre=${genre}`;

      axios.get(url)
        .then(response => {
          const movieList = document.getElementById('movie-list');
          movieList.innerHTML = ''; // 기존의 영화 목록을 초기화

          response.data.movies.forEach(function(movie) {
            const listItem = document.createElement('li');
            listItem.textContent = movie.title;
            movieList.appendChild(listItem);
          });
        })
        .catch((error) => {
          console.error('Error:', error)
        });
    });
  </script>
{% endblock %}